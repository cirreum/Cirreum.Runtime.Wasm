@namespace Cirreum.Components.Theme
@inject IThemeState ThemeState
@inject IThemeStateManager ThemeManager
@inject IThemeModeIconProvider ThemeIcons

<NavListDropdownButton TItemType="string"
					   IsDropMenu="false"
					   DropdownMinWidth="8"
					   SelectedValue="@ThemeState.Mode"
					   SelectedValueChanged="@OnModeChanged"
					   ResponsiveAlignment="@Alignment"
					   AriaLabel="Theme Selector">
	<TextTemplate>
		<i class="bi @ThemeIcons.ResolveModeIcon(ThemeState.Mode)" aria-hidden="true"></i> @Label
	</TextTemplate>
	<ChildContent>
		@foreach (var mode in Enum.GetValues<ThemeMode>()) {
			<DropdownItemButton Value="@mode.ToShortName()">
				<InteractiveTemplate>
					<div class="d-flex">
						<i class="bi @ThemeIcons.ResolveModeIcon(mode)"></i>
						<span class="ms-2">@mode.ToName()</span>
						@if (context.IsActive) {
							<i class="bi bi-check ms-auto"></i>
						}
					</div>
				</InteractiveTemplate>
			</DropdownItemButton>
		}
	</ChildContent>
</NavListDropdownButton>

@code {

	/// <summary>
	/// Optional label for the theme selector, displayed next to the icon.
	/// </summary>
	[Parameter]
	public string? Label { get; set; }

	/// <summary>
	/// Defaults to <see cref="DropdownAlignment.End"/> for use with the NavBar
	/// Menu in the top right corner.
	/// </summary>
	[Parameter]
	public DropdownAlignment Alignment { get; set; } = DropdownAlignment.End;

	private void OnModeChanged(string modeName) {
		var mode = Enum.Parse<ThemeMode>(modeName, true);
		this.ThemeManager.SetMode(mode);
	}

}